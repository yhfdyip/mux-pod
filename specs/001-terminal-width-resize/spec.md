# Feature Specification: Terminal Width Auto-Resize

**Feature Branch**: `001-terminal-width-resize`
**Created**: 2026-01-11
**Status**: Draft
**Input**: User description: "ターミナル横幅リサイズ機能: ペイン選択時にtmuxのpane_widthに合わせてターミナル表示幅を自動調整。設定で最小文字サイズを設定可能。最小サイズ未満の場合は水平スクロール有効化。ピンチで拡大縮小対応。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Auto-fit Terminal to Pane Width (Priority: P1)

ユーザーがtmuxペインを選択すると、ターミナル表示が自動的にペインの横幅（文字数）に合わせてフィットする。これにより、デスクトップ環境と同じ表示レイアウトでターミナルを確認できる。

**Why this priority**: これはこの機能の核心であり、tmuxペインの横幅に合わせた表示がなければ、行の折り返しが発生してデスクトップ環境と異なる表示になってしまう。最も重要なユーザー体験を提供する。

**Independent Test**: ペインを選択し、ターミナル表示がペインの横幅（例: 80文字、120文字、200文字）に正確にフィットすることを確認できる。

**Acceptance Scenarios**:

1. **Given** SSH接続済みでtmuxセッションが開いている状態, **When** 80文字幅のペインを選択する, **Then** ターミナル表示が80文字幅でフィットし、すべての文字が画面内に収まる
2. **Given** SSH接続済みでtmuxセッションが開いている状態, **When** 200文字幅のペインを選択する, **Then** フォントサイズが縮小されて200文字幅がスクリーン幅内に収まる
3. **Given** ペイン表示中, **When** ペインを別のウィンドウに切り替える, **Then** 新しいペインの横幅に合わせて表示が再調整される

---

### User Story 2 - Minimum Font Size Setting (Priority: P2)

ユーザーが設定画面で最小フォントサイズを指定できる。これにより、読みやすさを確保しながら自動調整の限界を設定できる。

**Why this priority**: 自動リサイズが極端に小さいフォントを生成すると読めなくなる。ユーザーが許容できる最小サイズを設定できることは、アクセシビリティとユーザー体験の両方に重要。

**Independent Test**: 設定画面で最小フォントサイズを変更し、その値がターミナル表示の自動調整に反映されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 設定画面を開いている状態, **When** 最小フォントサイズを8pxに設定する, **Then** 設定が保存され、次回起動時も8pxが維持される
2. **Given** 最小フォントサイズが10pxに設定されている状態, **When** ペインの横幅が非常に広い場合, **Then** フォントサイズは10px以下には縮小されない

---

### User Story 3 - Horizontal Scroll for Wide Panes (Priority: P2)

最小フォントサイズでもペイン全体を画面幅に収められない場合、水平スクロールが有効になる。

**Why this priority**: 最小フォントサイズ制限があるため、極端に広いペインでは画面に収まりきらない。水平スクロールにより、そのような場合でもすべてのコンテンツにアクセス可能。

**Independent Test**: 非常に広いペイン（例: 300文字）を選択し、水平スクロールでコンテンツ全体を確認できることを確認する。

**Acceptance Scenarios**:

1. **Given** 最小フォントサイズが10pxで、300文字幅のペインを表示している状態, **When** 最小フォントサイズでも画面幅を超える場合, **Then** 水平スクロールが有効になり、左右にスクロールできる
2. **Given** 水平スクロールが有効な状態, **When** 画面右端までスクロールする, **Then** ペインの最右端の文字が表示される

---

### User Story 4 - Pinch to Zoom (Priority: P3)

ユーザーがピンチジェスチャーでフォントサイズを一時的に拡大・縮小できる。

**Why this priority**: モバイルデバイスで標準的なジェスチャーであり、細かい文字を確認したいときやコンテンツを俯瞰したいときに便利。ただし、P1/P2の機能が先に実装されていれば、基本的なユースケースはカバーされている。

**Independent Test**: ターミナル表示中にピンチイン/ピンチアウトし、フォントサイズが動的に変化することを確認できる。

**Acceptance Scenarios**:

1. **Given** ターミナルが表示されている状態, **When** ピンチアウト（2本指を広げる）する, **Then** フォントサイズが拡大される
2. **Given** ターミナルが表示されている状態, **When** ピンチイン（2本指を狭める）する, **Then** フォントサイズが縮小される（最小フォントサイズまで）
3. **Given** ピンチでフォントサイズを変更した状態, **When** 別のペインに切り替える, **Then** 新しいペインの横幅に基づいた自動調整が適用される

---

### Edge Cases

- 極端に狭いペイン（例: 10文字幅）の場合、フォントサイズが画面幅いっぱいまで拡大される
- ペインの横幅が0または取得できない場合、デフォルト値（80文字）を使用する
- 折りたたみデバイスで画面幅が動的に変わった場合、再計算を行う
- ピンチ操作中にペイン内容が更新された場合、表示を維持しながらコンテンツを更新する
- 縦向き/横向き切り替え時、横幅に合わせた再計算を行う
- 水平スクロール中にペインを切り替えた場合、スクロール位置をリセットする

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはペイン選択時にtmuxの`pane_width`（文字数）を取得しなければならない
- **FR-002**: システムは取得したペイン横幅に基づいて、画面幅内に収まるようフォントサイズを自動計算しなければならない
- **FR-003**: ユーザーは設定画面で最小フォントサイズ（ポイント単位）を設定できなければならない
- **FR-004**: システムは自動計算されたフォントサイズが最小値を下回る場合、最小値を適用しなければならない
- **FR-005**: システムは最小フォントサイズでもコンテンツが画面幅を超える場合、水平スクロールを有効にしなければならない
- **FR-006**: ユーザーはピンチジェスチャーでフォントサイズを拡大・縮小できなければならない
- **FR-007**: システムはピンチ操作でも最小フォントサイズ制限を適用しなければならない
- **FR-008**: システムはペイン切り替え時に新しいペインの横幅に合わせて表示を再調整しなければならない
- **FR-009**: システムは画面回転時に横幅に合わせた再計算を行わなければならない
- **FR-010**: システムは最小フォントサイズ設定を永続化しなければならない

### Key Entities

- **TerminalDisplayState**: ターミナル表示の状態を管理するエンティティ。現在のフォントサイズ、ペイン横幅（文字数）、スクロールオフセット、ズーム倍率を保持する
- **TerminalDisplaySettings**: ユーザー設定を管理するエンティティ。最小フォントサイズを保持し、永続化される

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ペイン選択から表示調整完了まで500ms以内に完了する
- **SC-002**: 80文字から200文字幅のペインで、行の折り返しなしに全文字が表示される（水平スクロールなしで収まる場合）
- **SC-003**: ピンチ操作に対するフォントサイズ変更が滑らかに表示される
- **SC-004**: 最小フォントサイズ設定が100%のケースで正しく適用される
- **SC-005**: 水平スクロール時、ペインの全コンテンツにアクセスできる

## Assumptions

- デフォルトの最小フォントサイズは8px（業界標準のモバイルアプリ読みやすさ基準）
- ピンチ操作後にペインを切り替えると、自動フィットモードに戻る（ユーザーの一時的な拡大/縮小はリセット）
- ペイン横幅が取得できない場合のフォールバック値は80文字（標準ターミナル幅）
- 等幅フォント（モノスペースフォント）を使用している前提で、1文字あたりの幅は一定
